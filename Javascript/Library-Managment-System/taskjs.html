<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <script>
    let Library = []; // Initialize the Library array

    function addBook() {
      let bookTitle = prompt("Enter book title: ");
      if (bookTitle === "") {
        alert("Title Cannot be empty. Please try again  ");
        return;
      }
      if (Library.some((book) => book.title === bookTitle)) {
        alert(
          "Book with the same title already exists. Will increase copies instead.",
        );
        function increase(bookTitle) {
          book = Library.find((book) => book.title === bookTitle);
          book.copies++;
          alert("Copies increased successfully.");
          return;
        }
        increase(bookTitle);
      } else {
        let authorName = prompt("Enter author name: ");
        if (authorName === "") {
          alert("Author Name Cannot be empty . Please try again  ");
          return;
        }
        let copies = parseInt(prompt("Enter number of copies: "));
        if (isNaN(copies) || copies <= 0) {
          alert(
            "Copies must be a number greater than zero. Please try again  ",
          );
          return;
        }
        let book = {
          title: bookTitle,
          author: authorName,
          copies: copies,
          borrowedCount: 0,
        };
        Library.push(book);
        alert("Book added successfully.");

        return;
      }
    }

    function borrowBook() {
      let desiredBook = prompt(
        "Enter the title of the book you wish to borrow: ",
      );
      if (desiredBook === null || desiredBook.trim() === "") {
        alert("You canceled the operation.");
        return;
      }
      let book = Library.find((book) => book.title === desiredBook);
      if (!book) {
        alert("Book not found. Please try again.");
        return;
      }

      if (book.copies === 0) {
        alert("No available copies. Please try again.");
        return;
      }
      book.copies--;
      book.borrowed++;
      book.borrowedCount++;

      alert(
        `Book "${desiredBook}" borrowed successfully.\nAvailable Copies: ${book.copies},
    Borrowed Count: ${book.borrowed}\n`,
      );
    }

    function returnBook() {
      let desiredBook = prompt(
        "Enter the title of the book you wish to return: ",
        "",
      );
      if (desiredBook === null || desiredBook.trim() === "") {
        alert("You canceled the operation.");
        return;
      }
      let book = Library.find((book) => book.title === desiredBook);
      if (!book) {
        alert("Book not found. Please try again.");
        return;
      }

      if (book.borrowed === 0) {
        alert("No borrowed copies. Please try again.");
        return;
      }
      book.copies++;
      book.borrowed--;

      alert(
        `Book "${desiredBook}" returned successfully.\nAvailable Copies: ${book.copies},
    Borrowed Count: ${book.borrowed}\n`,
      );
    }

    function calculateTotalBooks(Library) {
      let totalAvailable = 0;
      let totalBorrowed = 0;

      for (let i = 0; i < Library.length; i++) {
        totalAvailable += parseInt(Library[i].availableCopies);
        totalBorrowed += parseInt(Library[i].borrowedCopies);
      }

      return [totalAvailable, totalBorrowed];
    }

    function calculateStatus(copies) {
      let status = "Available";
      if (copies <= 2 && book.copies > 0) status = "Limited";
      if (copies === 0) status = "Out of Stock";
      return status;
    }

    function showReport() {
      if (!Library.length) {
        alert("The library is empty. Please add books first.");
        return;
      }

      let calresults = calculateTotalBooks(Library);

      let totalAvailable = calresults[0];
      let totalBorrowed = calresults[1];

      console.log("Total Available Books:", totalAvailable);

      console.log("weselna hena");
      console.log("Total Available Books:", totalAvailable);

      let report = `--Total Available Books: ${totalAvailable}\n--Total Borrowed Books: ${totalBorrowed}\n\n`;
      for (let i = 0; i < Library.length; i++) {
        let status = calculateStatus(Library[i].copies);
        report += `-Book: ${Library[i].title}, Author: ${Library[i].author}, Copies: ${Library[i].copies},
        -Borrowed: ${Library[i].borrowed}\n 
        -Status: ${calculateStatus(Library[i])}\n
        -Borrowed Count History: ${Library[i].borrowedCount}\n`;
      }
      alert(report);
    }

    do {
      opt = prompt(
        "===== MENU ===== \n1 → Add New Book \n2 →  Borrow Book \n3 → Return Book \n4 → Show Library Report \n5 → Exit",
      );
      switch (opt) {
        case "1":
          addBook();
          break;
        case "2":
          borrowBook();
          break;
        case "3":
          returnBook();
          break;
        case "4":
          showReport();
          break;
        case "5":
          break;
        default:
          alert("Invalid Option! Please try again.");
      }
    } while (opt != "5");
  </script>
</html>
